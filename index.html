<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Research Tool - Analisis Video Trending</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        youtube: '#FF0000',
                        dark: {
                            bg: '#0f0f23',
                            card: '#1a1a2e',
                            border: '#16213e'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            box-sizing: border-box;
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #FF0000;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body class="h-full bg-dark-bg text-white font-sans">
    <div class="min-h-full">
        <!-- Header -->
        <header class="bg-dark-card border-b border-dark-border">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-youtube rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-white">YouTube Research Tool</h1>
                            <p class="text-gray-400 text-sm">Analisis video trending & estimasi pendapatan</p>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- API Key Setup -->
            <div id="apiKeySection" class="bg-dark-card rounded-xl border border-dark-border p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5 text-youtube" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v2H2v-4l4.257-4.257A6 6 0 1118 8zm-6-4a1 1 0 100 2 2 2 0 012 2 1 1 0 102 0 4 4 0 00-4-4z" clip-rule="evenodd"/>
                        </svg>
                        <h3 class="text-lg font-semibold text-white">YouTube API Key</h3>
                        <div id="apiKeyStatus" class="hidden">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-900/50 text-green-300 border border-green-500/50">
                                ‚úì Tersimpan
                            </span>
                        </div>
                    </div>
                    <button id="toggleApiSection" class="text-gray-400 hover:text-white transition-colors duration-200">
                        <svg id="hideIcon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
                        </svg>
                        <svg id="showIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                </div>
                <div id="apiKeyContent">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 items-end">
                        <div class="lg:col-span-2">
                            <label class="block text-sm font-medium text-gray-300 mb-2">
                                Masukkan YouTube Data API v3 Key Anda
                            </label>
                            <input type="password" id="apiKeyInput" placeholder="AIzaSyC-..." 
                                   class="w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-youtube focus:border-transparent">
                            <p class="text-xs text-gray-500 mt-1">
                                API key disimpan lokal di browser Anda dan tidak dikirim ke server manapun
                            </p>
                        </div>
                        <div>
                            <button id="toggleApiKey" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 text-sm">
                                üëÅÔ∏è Tampilkan
                            </button>
                        </div>
                    </div>
                    <div class="mt-4 p-3 bg-blue-900/30 border border-blue-500/50 rounded-lg">
                        <div class="flex items-start space-x-2">
                            <svg class="w-4 h-4 text-blue-400 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                            </svg>
                            <div class="text-xs text-blue-200">
                                <strong>Cara mendapatkan API Key:</strong><br>
                                1. Buka <a href="https://console.cloud.google.com/" target="_blank" class="text-blue-400 hover:underline">Google Cloud Console</a><br>
                                2. Buat project baru ‚Üí APIs & Services ‚Üí Library<br>
                                3. Cari "YouTube Data API v3" ‚Üí Enable<br>
                                4. Credentials ‚Üí Create Credentials ‚Üí API Key
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="bg-dark-card rounded-xl border border-dark-border p-6 mb-6">
                <div class="flex space-x-1 bg-dark-bg rounded-lg p-1">
                    <button id="trendingTab" class="flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors duration-200 bg-youtube text-white">
                        üî• Video Trending
                    </button>
                    <button id="channelTab" class="flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors duration-200 text-gray-400 hover:text-white">
                        üì∫ Analisis Channel
                    </button>
                </div>
            </div>

            <!-- Trending Controls -->
            <div id="trendingControls" class="bg-dark-card rounded-xl border border-dark-border p-6 mb-8">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Region</label>
                        <select id="regionSelect" class="w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-youtube focus:border-transparent">
                            <option value="ID">üáÆüá© Indonesia</option>
                            <option value="US">üá∫üá∏ United States</option>
                            <option value="JP">üáØüáµ Japan</option>
                            <option value="KR">üá∞üá∑ South Korea</option>
                            <option value="GB">üá¨üáß United Kingdom</option>
                            <option value="IN">üáÆüá≥ India</option>
                            <option value="BR">üáßüá∑ Brazil</option>
                            <option value="DE">üá©üá™ Germany</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Kategori</label>
                        <select id="categorySelect" class="w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-youtube focus:border-transparent">
                            <option value="">Semua Kategori</option>
                            <option value="1">Film & Animation</option>
                            <option value="2">Autos & Vehicles</option>
                            <option value="10">Music</option>
                            <option value="15">Pets & Animals</option>
                            <option value="17">Sports</option>
                            <option value="19">Travel & Events</option>
                            <option value="20">Gaming</option>
                            <option value="22">People & Blogs (ASMR, Vlog)</option>
                            <option value="23">Comedy</option>
                            <option value="24">Entertainment</option>
                            <option value="25">News & Politics</option>
                            <option value="26">Howto & Style</option>
                            <option value="27">Education</option>
                            <option value="28">Science & Technology</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Jumlah Video</label>
                        <select id="maxResults" class="w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-youtube focus:border-transparent">
                            <option value="10">10 Video</option>
                            <option value="20" selected>20 Video</option>
                            <option value="30">30 Video</option>
                            <option value="50">50 Video</option>
                        </select>
                    </div>
                    <div>
                        <button id="searchBtn" class="w-full bg-youtube hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center space-x-2 disabled:bg-gray-600 disabled:cursor-not-allowed">
                            <span id="searchText">Cari Trending</span>
                            <div id="loadingSpinner" class="loading-spinner hidden"></div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Channel Controls -->
            <div id="channelControls" class="bg-dark-card rounded-xl border border-dark-border p-6 mb-8 hidden">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-300 mb-2">URL Channel YouTube</label>
                        <input type="text" id="channelUrlInput" placeholder="https://www.youtube.com/@channelname atau https://www.youtube.com/channel/UCxxxxx" 
                               class="w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-youtube focus:border-transparent">
                        <p class="text-xs text-gray-500 mt-1">
                            Masukkan URL channel YouTube (format @username atau channel ID)
                        </p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Jumlah Video</label>
                        <select id="channelMaxResults" class="w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-youtube focus:border-transparent">
                            <option value="10">10 Video</option>
                            <option value="20" selected>20 Video</option>
                            <option value="30">30 Video</option>
                            <option value="50">50 Video</option>
                        </select>
                    </div>
                    <div>
                        <button id="analyzeChannelBtn" class="w-full bg-youtube hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center space-x-2 disabled:bg-gray-600 disabled:cursor-not-allowed">
                            <span id="analyzeText">Analisis Channel</span>
                            <div id="analyzeSpinner" class="loading-spinner hidden"></div>
                        </button>
                    </div>
                </div>
                <div class="mt-4 p-3 bg-orange-900/30 border border-orange-500/50 rounded-lg">
                    <div class="flex items-start space-x-2">
                        <svg class="w-4 h-4 text-orange-400 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                        </svg>
                        <div class="text-xs text-orange-200">
                            <strong>Format URL yang didukung:</strong><br>
                            ‚Ä¢ https://www.youtube.com/@channelname<br>
                            ‚Ä¢ https://www.youtube.com/channel/UCxxxxx<br>
                            ‚Ä¢ https://www.youtube.com/c/channelname<br>
                            ‚Ä¢ https://www.youtube.com/user/username
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Messages -->
            <div id="statusMessage" class="hidden mb-6">
                <div id="errorMessage" class="bg-red-900/50 border border-red-500 text-red-200 px-4 py-3 rounded-lg hidden">
                    <div class="flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                        </svg>
                        <span id="errorText"></span>
                    </div>
                </div>
                <div id="successMessage" class="bg-green-900/50 border border-green-500 text-green-200 px-4 py-3 rounded-lg hidden">
                    <div class="flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        <span id="successText"></span>
                    </div>
                </div>
            </div>

            <!-- Channel Info -->
            <div id="channelInfo" class="hidden mb-6">
                <div class="bg-dark-card rounded-xl border border-dark-border p-6">
                    <div class="flex items-start space-x-4">
                        <img id="channelThumbnail" src="" alt="Channel Avatar" class="w-20 h-20 rounded-full border-2 border-dark-border">
                        <div class="flex-1">
                            <h3 id="channelTitle" class="text-xl font-bold text-white mb-2"></h3>
                            <p id="channelDescription" class="text-gray-400 text-sm mb-4 line-clamp-3"></p>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div class="text-center">
                                    <div id="channelSubscribers" class="text-lg font-bold text-youtube">-</div>
                                    <div class="text-xs text-gray-500">Subscribers</div>
                                </div>
                                <div class="text-center">
                                    <div id="channelViews" class="text-lg font-bold text-green-400">-</div>
                                    <div class="text-xs text-gray-500">Total Views</div>
                                </div>
                                <div class="text-center">
                                    <div id="channelVideos" class="text-lg font-bold text-blue-400">-</div>
                                    <div class="text-xs text-gray-500">Videos</div>
                                </div>
                                <div class="text-center">
                                    <div id="channelCreated" class="text-lg font-bold text-purple-400">-</div>
                                    <div class="text-xs text-gray-500">Created</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Grid -->
            <div id="resultsContainer" class="hidden">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-white">Video Trending</h2>
                    <div class="text-sm text-gray-400">
                        <span id="resultsCount">0</span> video ditemukan
                    </div>
                </div>
                <div id="videoGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <!-- Video cards will be inserted here -->
                </div>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="text-center py-16">
                <div class="w-24 h-24 bg-dark-card rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-12 h-12 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                    </svg>
                </div>
                <h3 class="text-lg font-medium text-gray-300 mb-2">Belum ada data</h3>
                <p class="text-gray-500 mb-6">Masukkan API key dan pilih region untuk melihat video trending</p>
            </div>
        </main>
    </div>



    <script>
        // DOM Elements
        const searchBtn = document.getElementById('searchBtn');
        const searchText = document.getElementById('searchText');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const regionSelect = document.getElementById('regionSelect');
        const categorySelect = document.getElementById('categorySelect');
        const maxResults = document.getElementById('maxResults');
        const apiKeyInput = document.getElementById('apiKeyInput');
        const toggleApiKey = document.getElementById('toggleApiKey');
        const toggleApiSection = document.getElementById('toggleApiSection');
        const apiKeyContent = document.getElementById('apiKeyContent');
        const apiKeyStatus = document.getElementById('apiKeyStatus');
        const hideIcon = document.getElementById('hideIcon');
        const showIcon = document.getElementById('showIcon');
        const statusMessage = document.getElementById('statusMessage');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const errorText = document.getElementById('errorText');
        const successText = document.getElementById('successText');
        const resultsContainer = document.getElementById('resultsContainer');
        const videoGrid = document.getElementById('videoGrid');
        const emptyState = document.getElementById('emptyState');
        const resultsCount = document.getElementById('resultsCount');

        // Tab Elements
        const trendingTab = document.getElementById('trendingTab');
        const channelTab = document.getElementById('channelTab');
        const trendingControls = document.getElementById('trendingControls');
        const channelControls = document.getElementById('channelControls');

        // Channel Elements
        const channelUrlInput = document.getElementById('channelUrlInput');
        const channelMaxResults = document.getElementById('channelMaxResults');
        const analyzeChannelBtn = document.getElementById('analyzeChannelBtn');
        const analyzeText = document.getElementById('analyzeText');
        const analyzeSpinner = document.getElementById('analyzeSpinner');
        const channelInfo = document.getElementById('channelInfo');
        const channelThumbnail = document.getElementById('channelThumbnail');
        const channelTitle = document.getElementById('channelTitle');
        const channelDescription = document.getElementById('channelDescription');
        const channelSubscribers = document.getElementById('channelSubscribers');
        const channelViews = document.getElementById('channelViews');
        const channelVideos = document.getElementById('channelVideos');
        const channelCreated = document.getElementById('channelCreated');

        // Local Storage Keys
        const API_KEY_STORAGE = 'youtube_api_key';

        // Current mode
        let currentMode = 'trending';

        // Utility Functions
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) return '1 hari lalu';
            if (diffDays < 7) return `${diffDays} hari lalu`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)} minggu lalu`;
            return `${Math.floor(diffDays / 30)} bulan lalu`;
        }

        function formatFullDate(dateString) {
            const date = new Date(dateString);
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                timeZone: 'Asia/Jakarta'
            };
            return date.toLocaleDateString('id-ID', options);
        }

        function formatYearOnly(dateString) {
            const date = new Date(dateString);
            return date.getFullYear().toString();
        }

        function extractChannelId(url) {
            // Handle different YouTube URL formats
            const patterns = [
                /youtube\.com\/channel\/([a-zA-Z0-9_-]+)/,
                /youtube\.com\/@([a-zA-Z0-9_.-]+)/,
                /youtube\.com\/c\/([a-zA-Z0-9_.-]+)/,
                /youtube\.com\/user\/([a-zA-Z0-9_.-]+)/
            ];
            
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match) {
                    return { type: pattern.source.includes('channel') ? 'id' : 'username', value: match[1] };
                }
            }
            return null;
        }

        function switchTab(mode) {
            currentMode = mode;
            
            if (mode === 'trending') {
                // Update tab styles
                trendingTab.classList.add('bg-youtube', 'text-white');
                trendingTab.classList.remove('text-gray-400');
                channelTab.classList.remove('bg-youtube', 'text-white');
                channelTab.classList.add('text-gray-400');
                
                // Show/hide controls
                trendingControls.classList.remove('hidden');
                channelControls.classList.add('hidden');
                channelInfo.classList.add('hidden');
            } else {
                // Update tab styles
                channelTab.classList.add('bg-youtube', 'text-white');
                channelTab.classList.remove('text-gray-400');
                trendingTab.classList.remove('bg-youtube', 'text-white');
                trendingTab.classList.add('text-gray-400');
                
                // Show/hide controls
                channelControls.classList.remove('hidden');
                trendingControls.classList.add('hidden');
                resultsContainer.classList.add('hidden');
                emptyState.classList.remove('hidden');
            }
        }

        function extractKeywords(title, description = '') {
            // Combine title and description for keyword extraction
            const text = (title + ' ' + description).toLowerCase();
            
            // Common stop words to filter out
            const stopWords = ['the', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by', 'yang', 'dan', 'di', 'ke', 'dari', 'untuk', 'dengan', 'ini', 'itu', 'adalah', 'akan', 'sudah', 'telah', 'bisa', 'dapat', 'tidak', 'jangan', 'harus', 'mau', 'ingin', 'saya', 'kamu', 'dia', 'kita', 'mereka', 'kami'];
            
            // Extract words and filter
            const words = text.match(/\b\w{3,}\b/g) || [];
            const filteredWords = words.filter(word => !stopWords.includes(word));
            
            // Count frequency
            const wordCount = {};
            filteredWords.forEach(word => {
                wordCount[word] = (wordCount[word] || 0) + 1;
            });
            
            // Sort by frequency and return top keywords
            return Object.entries(wordCount)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5)
                .map(([word]) => word);
        }

        function showMessage(type, message) {
            statusMessage.classList.remove('hidden');
            if (type === 'error') {
                errorMessage.classList.remove('hidden');
                successMessage.classList.add('hidden');
                errorText.textContent = message;
            } else {
                successMessage.classList.remove('hidden');
                errorMessage.classList.add('hidden');
                successText.textContent = message;
            }
            
            setTimeout(() => {
                statusMessage.classList.add('hidden');
            }, 5000);
        }

        function setLoading(loading) {
            if (loading) {
                searchBtn.disabled = true;
                searchText.textContent = 'Mencari...';
                loadingSpinner.classList.remove('hidden');
            } else {
                searchBtn.disabled = false;
                searchText.textContent = 'Cari Trending';
                loadingSpinner.classList.add('hidden');
            }
        }

        function setChannelLoading(loading) {
            if (loading) {
                analyzeChannelBtn.disabled = true;
                analyzeText.textContent = 'Menganalisis...';
                analyzeSpinner.classList.remove('hidden');
            } else {
                analyzeChannelBtn.disabled = false;
                analyzeText.textContent = 'Analisis Channel';
                analyzeSpinner.classList.add('hidden');
            }
        }

        function saveApiKey(apiKey) {
            localStorage.setItem(API_KEY_STORAGE, apiKey);
        }

        function loadApiKey() {
            return localStorage.getItem(API_KEY_STORAGE) || '';
        }

        function validateApiKey(apiKey) {
            return apiKey && apiKey.trim().length > 20 && apiKey.startsWith('AIza');
        }

        function updateApiKeyStatus() {
            const apiKey = apiKeyInput.value.trim();
            if (validateApiKey(apiKey)) {
                apiKeyStatus.classList.remove('hidden');
                // Auto-hide API section after valid key is entered
                setTimeout(() => {
                    if (validateApiKey(apiKeyInput.value.trim())) {
                        hideApiKeySection();
                    }
                }, 1000);
            } else {
                apiKeyStatus.classList.add('hidden');
            }
        }

        function hideApiKeySection() {
            apiKeyContent.classList.add('hidden');
            hideIcon.classList.add('hidden');
            showIcon.classList.remove('hidden');
        }

        function showApiKeySection() {
            apiKeyContent.classList.remove('hidden');
            hideIcon.classList.remove('hidden');
            showIcon.classList.add('hidden');
        }

        function calculateRPM(video) {
            const categoryId = video.snippet.categoryId;
            const views = parseInt(video.statistics.viewCount);
            const region = regionSelect.value;
            
            // RPM realistis berdasarkan data industri YouTube 2024
            const categoryRPM = {
                '1': 0.8,   // Film & Animation
                '2': 1.2,   // Autos & Vehicles  
                '10': 0.3,  // Music (paling rendah)
                '15': 0.7,  // Pets & Animals
                '17': 1.1,  // Sports
                '19': 0.9,  // Travel & Events
                '20': 1.8,  // Gaming
                '22': 0.9,  // People & Blogs (ASMR tinggi karena watch time panjang)
                '23': 0.8,  // Comedy
                '24': 0.7,  // Entertainment
                '25': 2.1,  // News & Politics (tinggi karena audience dewasa)
                '26': 1.4,  // Howto & Style
                '27': 1.6,  // Education
                '28': 2.3   // Science & Technology (tertinggi)
            };
            
            let baseRPM = categoryRPM[categoryId] || 1.0;
            
            // Adjustment berdasarkan region (purchasing power)
            const regionMultiplier = {
                'US': 1.0,    // Base (tertinggi)
                'GB': 0.85,   // UK
                'DE': 0.8,    // Germany
                'JP': 0.75,   // Japan
                'KR': 0.6,    // South Korea
                'BR': 0.4,    // Brazil
                'IN': 0.25,   // India
                'ID': 0.2     // Indonesia (terendah)
            };
            
            baseRPM *= (regionMultiplier[region] || 0.5);
            
            // Viral bonus (lebih kecil dan realistis)
            if (views > 50000000) baseRPM *= 1.15;     // 50M+ views
            else if (views > 10000000) baseRPM *= 1.1; // 10M+ views
            else if (views > 1000000) baseRPM *= 1.05; // 1M+ views
            
            return Math.round(baseRPM * 100) / 100; // Round to 2 decimal
        }

        function createVideoCard(video, index, isChannelMode = false) {
            const views = parseInt(video.statistics.viewCount);
            const rpm = calculateRPM(video);
            const estimatedEarnings = (views / 1000) * rpm;
            const keywords = extractKeywords(video.snippet.title, video.snippet.description);
            
            return `
                <div class="bg-dark-card border border-dark-border rounded-xl overflow-hidden card-hover">
                    <div class="relative">
                        <img src="${video.snippet.thumbnails.medium.url}" 
                             alt="${video.snippet.title}" 
                             class="w-full h-48 object-cover"
                             onerror="this.src=''; this.alt='Thumbnail gagal dimuat'; this.style.display='none';">
                        <div class="absolute top-2 left-2 ${isChannelMode ? 'bg-blue-600' : 'bg-youtube'} text-white text-xs font-bold px-2 py-1 rounded">
                            ${isChannelMode ? `Video ${index + 1}` : `#${index + 1}`}
                        </div>
                        <div class="absolute bottom-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded">
                            ${formatDate(video.snippet.publishedAt)}
                        </div>
                    </div>
                    <div class="p-4">
                        <h3 class="font-semibold text-white text-sm mb-2 line-clamp-2 leading-tight">
                            ${video.snippet.title}
                        </h3>
                        <p class="text-gray-400 text-xs mb-3 truncate">
                            ${video.snippet.channelTitle}
                        </p>
                        
                        <!-- Upload Date & Time -->
                        <div class="bg-blue-900/30 border border-blue-500/50 rounded-lg p-2 mb-3">
                            <div class="flex items-center space-x-1">
                                <svg class="w-3 h-3 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                                </svg>
                                <span class="text-blue-300 text-xs font-medium">Upload:</span>
                            </div>
                            <p class="text-blue-200 text-xs mt-1">${formatFullDate(video.snippet.publishedAt)}</p>
                        </div>

                        <!-- Keywords -->
                        <div class="mb-3">
                            <div class="flex items-center space-x-1 mb-2">
                                <svg class="w-3 h-3 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M9.243 3.03a1 1 0 01.727 1.213L9.53 6h2.94l.56-2.243a1 1 0 111.94.486L14.53 6H17a1 1 0 110 2h-2.97l-1 4H15a1 1 0 110 2h-2.47l-.56 2.242a1 1 0 11-1.94-.485L10.47 14H7.53l-.56 2.242a1 1 0 11-1.94-.485L5.47 14H3a1 1 0 110-2h2.97l1-4H5a1 1 0 110-2h2.47l.56-2.243a1 1 0 011.213-.727zM9.03 8l-1 4h2.94l1-4H9.03z" clip-rule="evenodd"/>
                                </svg>
                                <span class="text-purple-300 text-xs font-medium">Keywords:</span>
                            </div>
                            <div class="flex flex-wrap gap-1">
                                ${keywords.map(keyword => 
                                    `<span class="bg-purple-900/40 text-purple-200 text-xs px-2 py-1 rounded-full border border-purple-500/30">${keyword}</span>`
                                ).join('')}
                            </div>
                        </div>
                        
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400 text-xs">Views:</span>
                                <span class="text-white font-medium text-sm">${formatNumber(views)}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400 text-xs">RPM:</span>
                                <span class="text-white font-medium text-sm">$${rpm}</span>
                            </div>
                        </div>
                        <div class="bg-green-900/30 border border-green-500/50 rounded-lg p-3 mb-4">
                            <div class="text-center">
                                <div class="text-green-400 text-xs font-medium mb-1">Estimasi Pendapatan</div>
                                <div class="text-green-300 text-lg font-bold">${formatCurrency(estimatedEarnings)}</div>
                            </div>
                        </div>
                        <button onclick="copyVideoLink('${video.id}', this)" 
                                class="block w-full bg-youtube hover:bg-red-700 text-white text-center py-2 px-4 rounded-lg transition-colors duration-200 text-sm font-medium cursor-pointer">
                            üìã Copy Link Video
                        </button>
                    </div>
                </div>
            `;
        }

        async function getChannelIdFromUsername(username, apiKey) {
            try {
                const response = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=id&forUsername=${username}&key=${apiKey}`);
                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    return data.items[0].id;
                }
                
                // Try search if forUsername doesn't work
                const searchResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=channel&q=${username}&key=${apiKey}`);
                const searchData = await searchResponse.json();
                
                if (searchData.items && searchData.items.length > 0) {
                    return searchData.items[0].snippet.channelId;
                }
                
                return null;
            } catch (error) {
                console.error('Error getting channel ID:', error);
                return null;
            }
        }

        async function analyzeChannel() {
            const apiKey = apiKeyInput.value.trim();
            const channelUrl = channelUrlInput.value.trim();
            const maxChannelResults = parseInt(channelMaxResults.value);

            // Validation
            if (!validateApiKey(apiKey)) {
                showMessage('error', 'API Key tidak valid. Pastikan API key dimulai dengan "AIza" dan memiliki panjang yang sesuai.');
                return;
            }

            if (!channelUrl) {
                showMessage('error', 'Masukkan URL channel YouTube terlebih dahulu.');
                return;
            }

            const channelData = extractChannelId(channelUrl);
            if (!channelData) {
                showMessage('error', 'Format URL channel tidak valid. Gunakan format yang didukung.');
                return;
            }

            setChannelLoading(true);
            
            try {
                let channelId = channelData.value;
                
                // If it's a username, get the channel ID first
                if (channelData.type === 'username') {
                    channelId = await getChannelIdFromUsername(channelData.value, apiKey);
                    if (!channelId) {
                        throw new Error('Channel tidak ditemukan. Periksa URL channel Anda.');
                    }
                }

                // Get channel details
                const channelResponse = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&id=${channelId}&key=${apiKey}`);
                
                if (!channelResponse.ok) {
                    const errorData = await channelResponse.json();
                    throw new Error(errorData.error?.message || `HTTP ${channelResponse.status}: ${channelResponse.statusText}`);
                }
                
                const channelInfo = await channelResponse.json();
                
                if (!channelInfo.items || channelInfo.items.length === 0) {
                    throw new Error('Channel tidak ditemukan.');
                }

                // Get channel videos with custom maxResults
                const videosResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&type=video&order=date&maxResults=${maxChannelResults}&key=${apiKey}`);
                
                if (!videosResponse.ok) {
                    const errorData = await videosResponse.json();
                    throw new Error(errorData.error?.message || `HTTP ${videosResponse.status}: ${videosResponse.statusText}`);
                }
                
                const videosData = await videosResponse.json();
                
                if (!videosData.items || videosData.items.length === 0) {
                    throw new Error('Tidak ada video ditemukan di channel ini.');
                }

                // Get detailed video statistics
                const videoIds = videosData.items.map(item => item.id.videoId).join(',');
                const videoStatsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=statistics,snippet&id=${videoIds}&key=${apiKey}`);
                const videoStatsData = await videoStatsResponse.json();

                displayChannelInfo(channelInfo.items[0]);
                displayResults(videoStatsData.items, true);
                showMessage('success', `Berhasil menganalisis channel dengan ${videoStatsData.items.length} video terbaru`);
                
            } catch (error) {
                console.error('Error analyzing channel:', error);
                let errorMsg = error.message;
                
                // Handle common API errors
                if (errorMsg.includes('API_KEY_INVALID')) {
                    errorMsg = 'API Key tidak valid. Periksa kembali API key Anda.';
                } else if (errorMsg.includes('QUOTA_EXCEEDED')) {
                    errorMsg = 'Kuota API sudah habis. Coba lagi besok atau gunakan API key lain.';
                } else if (errorMsg.includes('ACCESS_NOT_CONFIGURED')) {
                    errorMsg = 'YouTube Data API v3 belum diaktifkan. Aktifkan di Google Cloud Console.';
                }
                
                showMessage('error', `Gagal menganalisis channel: ${errorMsg}`);
                channelInfo.classList.add('hidden');
                emptyState.classList.remove('hidden');
                resultsContainer.classList.add('hidden');
            } finally {
                setChannelLoading(false);
            }
        }

        function displayChannelInfo(channel) {
            const stats = channel.statistics;
            const snippet = channel.snippet;
            
            channelThumbnail.src = snippet.thumbnails.medium?.url || snippet.thumbnails.default?.url || '';
            channelThumbnail.onerror = function() {
                this.src = '';
                this.alt = 'Avatar gagal dimuat';
                this.style.display = 'none';
            };
            
            channelTitle.textContent = snippet.title;
            channelDescription.textContent = snippet.description || 'Tidak ada deskripsi';
            channelSubscribers.textContent = formatNumber(parseInt(stats.subscriberCount || 0));
            channelViews.textContent = formatNumber(parseInt(stats.viewCount || 0));
            channelVideos.textContent = formatNumber(parseInt(stats.videoCount || 0));
            channelCreated.textContent = formatYearOnly(snippet.publishedAt);
            
            channelInfo.classList.remove('hidden');
        }

        async function fetchTrendingVideos() {
            const apiKey = apiKeyInput.value.trim();
            const region = regionSelect.value;
            const category = categorySelect.value;
            const max = parseInt(maxResults.value);

            // Validation
            if (!validateApiKey(apiKey)) {
                showMessage('error', 'API Key tidak valid. Pastikan API key dimulai dengan "AIza" dan memiliki panjang yang sesuai.');
                return;
            }

            // Save API key to localStorage
            saveApiKey(apiKey);

            setLoading(true);
            
            try {
                // Build URL with optional category filter
                let url = `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&chart=mostPopular&regionCode=${region}&maxResults=${max}&key=${apiKey}`;
                if (category) {
                    url += `&videoCategoryId=${category}`;
                }
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (!data.items || data.items.length === 0) {
                    throw new Error('Tidak ada video trending ditemukan untuk region ini');
                }
                
                displayResults(data.items);
                showMessage('success', `Berhasil memuat ${data.items.length} video trending dari ${region}`);
                
            } catch (error) {
                console.error('Error fetching data:', error);
                let errorMsg = error.message;
                
                // Handle common API errors
                if (errorMsg.includes('API_KEY_INVALID')) {
                    errorMsg = 'API Key tidak valid. Periksa kembali API key Anda.';
                } else if (errorMsg.includes('QUOTA_EXCEEDED')) {
                    errorMsg = 'Kuota API sudah habis. Coba lagi besok atau gunakan API key lain.';
                } else if (errorMsg.includes('ACCESS_NOT_CONFIGURED')) {
                    errorMsg = 'YouTube Data API v3 belum diaktifkan. Aktifkan di Google Cloud Console.';
                }
                
                showMessage('error', `Gagal memuat data: ${errorMsg}`);
                emptyState.classList.remove('hidden');
                resultsContainer.classList.add('hidden');
            } finally {
                setLoading(false);
            }
        }

        function displayResults(videos, isChannelMode = false) {
            if (!videos || videos.length === 0) {
                emptyState.classList.remove('hidden');
                resultsContainer.classList.add('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            resultsContainer.classList.remove('hidden');
            resultsCount.textContent = videos.length;
            
            // Update header text based on mode
            const headerText = isChannelMode ? 'Video Channel' : 'Video Trending';
            document.querySelector('#resultsContainer h2').textContent = headerText;
            
            videoGrid.innerHTML = videos.map((video, index) => 
                createVideoCard(video, index, isChannelMode)
            ).join('');
        }

        // Function to copy YouTube video link
        function copyVideoLink(videoId, buttonElement) {
            const videoUrl = `https://www.youtube.com/watch?v=${videoId}`;
            
            // Try to copy to clipboard
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(videoUrl).then(() => {
                    showCopySuccess(buttonElement);
                }).catch(() => {
                    fallbackCopyTextToClipboard(videoUrl, buttonElement);
                });
            } else {
                fallbackCopyTextToClipboard(videoUrl, buttonElement);
            }
        }

        // Fallback copy method for older browsers
        function fallbackCopyTextToClipboard(text, buttonElement) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";
            textArea.style.opacity = "0";
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopySuccess(buttonElement);
                } else {
                    showCopyError(buttonElement);
                }
            } catch (err) {
                showCopyError(buttonElement);
            }
            
            document.body.removeChild(textArea);
        }

        // Show copy success feedback
        function showCopySuccess(buttonElement) {
            const originalText = buttonElement.innerHTML;
            buttonElement.innerHTML = '‚úÖ Link Disalin!';
            buttonElement.classList.remove('bg-youtube', 'hover:bg-red-700');
            buttonElement.classList.add('bg-green-600', 'hover:bg-green-700');
            
            setTimeout(() => {
                buttonElement.innerHTML = originalText;
                buttonElement.classList.remove('bg-green-600', 'hover:bg-green-700');
                buttonElement.classList.add('bg-youtube', 'hover:bg-red-700');
            }, 2000);
        }

        // Show copy error feedback
        function showCopyError(buttonElement) {
            const originalText = buttonElement.innerHTML;
            buttonElement.innerHTML = '‚ùå Gagal Copy';
            buttonElement.classList.remove('bg-youtube', 'hover:bg-red-700');
            buttonElement.classList.add('bg-red-800', 'hover:bg-red-900');
            
            setTimeout(() => {
                buttonElement.innerHTML = originalText;
                buttonElement.classList.remove('bg-red-800', 'hover:bg-red-900');
                buttonElement.classList.add('bg-youtube', 'hover:bg-red-700');
            }, 2000);
        }

        // Event Listeners
        searchBtn.addEventListener('click', fetchTrendingVideos);
        analyzeChannelBtn.addEventListener('click', analyzeChannel);

        // Tab switching
        trendingTab.addEventListener('click', () => switchTab('trending'));
        channelTab.addEventListener('click', () => switchTab('channel'));

        // Toggle API Key visibility
        toggleApiKey.addEventListener('click', () => {
            if (apiKeyInput.type === 'password') {
                apiKeyInput.type = 'text';
                toggleApiKey.textContent = 'üôà Sembunyikan';
            } else {
                apiKeyInput.type = 'password';
                toggleApiKey.textContent = 'üëÅÔ∏è Tampilkan';
            }
        });

        // Toggle API Key section
        toggleApiSection.addEventListener('click', () => {
            if (apiKeyContent.classList.contains('hidden')) {
                showApiKeySection();
            } else {
                hideApiKeySection();
            }
        });

        // Save API key on input and update status
        apiKeyInput.addEventListener('input', () => {
            const apiKey = apiKeyInput.value.trim();
            if (apiKey) {
                saveApiKey(apiKey);
            }
            updateApiKeyStatus();
        });

        // Allow Enter key to trigger search
        [regionSelect, categorySelect, maxResults, apiKeyInput].forEach(element => {
            element.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    if (currentMode === 'trending') {
                        fetchTrendingVideos();
                    }
                }
            });
        });

        // Allow Enter key for channel analysis
        [channelUrlInput, channelMaxResults].forEach(element => {
            element.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    analyzeChannel();
                }
            });
        });



        // Load saved API key on page load
        document.addEventListener('DOMContentLoaded', () => {
            const savedApiKey = loadApiKey();
            if (savedApiKey) {
                apiKeyInput.value = savedApiKey;
                updateApiKeyStatus();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98e54f3eb7d9f9b3',t:'MTc2MDQyNjM3OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
